create database accident
use accident
CREATE TABLE PERSON
(
D_ID VARCHAR(10) PRIMARY KEY,
D_NAME VARCHAR(25),
ADDR VARCHAR(30)
)

CREATE TABLE CAR
(
REG_NO VARCHAR(10) PRIMARY KEY,
MODEL VARCHAR(10),
YEAR DATE
)
CREATE TABLE ACCIDENT
(
REPORT_NUM INT PRIMARY KEY,
ACC_DATE DATE,
ACC_LOC VARCHAR(30)
)

CREATE TABLE OWNS
(
D_ID VARCHAR(10) REFERENCES PERSON(D_ID),
REG_NO VARCHAR(10) REFERENCES CAR(REG_NO),
PRIMARY KEY(D_ID,REG_NO)
)

CREATE TABLE PARTICIPATED
(
D_ID VARCHAR(10) REFERENCES PERSON(D_ID),

REG_NO VARCHAR(10) REFERENCES CAR(REG_NO),
REPORT_NUM INT REFERENCES ACCIDENT(REPORT_NUM),
DAM_AMOUNT INT,
PRIMARY KEY (D_ID,REG_NO,REPORT_NUM)
)

INSERT INTO PERSON VALUES('00001','AAAA','UDUPI')
INSERT INTO PERSON VALUES('00002','BBBB','MANGALORE')
INSERT INTO PERSON VALUES('00003','CCCC','BANGALORE')
INSERT INTO PERSON VALUES('00004','EEEE','MANGALORE')
INSERT INTO PERSON VALUES('00005','FFFF','BANGALORE')
INSERT INTO PERSON VALUES('00006','GGGG','MANGALORE')
SELECT * FROM PERSON

INSERT INTO CAR VALUES('101','A','2000-03-28')
INSERT INTO CAR VALUES('102','B','2000-04-28')
INSERT INTO CAR VALUES('103','C','2000-05-28')
INSERT INTO CAR VALUES('104','D','2000-06-28')
INSERT INTO CAR VALUES('105','E','2000-07-28')
INSERT INTO CAR VALUES('106','F','2000-08-28')
SELECT * FROM CAR

INSERT INTO ACCIDENT VALUES(1,'2002-04-25','UDUPI')
INSERT INTO ACCIDENT VALUES(2,'2003-05-05','BANGALORE')
INSERT INTO ACCIDENT VALUES(3,'2005-06-26','MANGALORE')
INSERT INTO ACCIDENT VALUES(4,'2002-07-15','UDUPI')
INSERT INTO ACCIDENT VALUES(5,'2008-08-03','MANGALORE')
SELECT * FROM ACCIDENT
INSERT INTO OWNS VALUES('00001','101')
INSERT INTO OWNS VALUES('00002','102')
INSERT INTO OWNS VALUES('00003','103')
INSERT INTO OWNS VALUES('00004','104')
INSERT INTO OWNS VALUES('00005','105')
INSERT INTO OWNS VALUES('00001','106')
UPDATE OWNS SET D_ID='00006' WHERE REG_NO='106'
SELECT * FROM OWNS
INSERT INTO PARTICIPATED VALUES('00001','101',1,2000)
INSERT INTO PARTICIPATED VALUES('00002','102',2,2000)
INSERT INTO PARTICIPATED VALUES('00003','103',3,2000)
INSERT INTO PARTICIPATED VALUES('00004','104',4,2000)
INSERT INTO PARTICIPATED VALUES('00005','105',5,2000)
INSERT INTO PARTICIPATED VALUES('00006','106',5,2000)
SELECT * FROM PARTICIPATED

SELECT DISTINCT P.D_NAME FROM PERSON P, OWNS O, PARTICIPATED PA, ACCIDENT A WHERE P.D_ID = O.D_ID AND O.REG_NO = PA.REG_NO AND PA.REPORT_NUM = A.REPORT_NUM AND YEAR(A.ACC_DATE) = 2008;

SELECT P.D_NAME, C.MODEL
FROM PERSON P, CAR C, ACCIDENT A, PARTICIPATED P1
WHERE P.D_ID = P1.D_ID
AND C.REG_NO = P1.REG_NO
AND A.REPORT_NUM = P1.REPORT_NUM
AND YEAR(A.ACC_DATE) = 2008
GROUP BY P.D_NAME, C.MODEL
HAVING COUNT(*) >= ALL
(
    SELECT COUNT(*)
    FROM PERSON P2, CAR C1, ACCIDENT A1, PARTICIPATED P4
    WHERE P2.D_ID = P4.D_ID
    AND C1.REG_NO = P4.REG_NO
    AND A1.REPORT_NUM = P4.REPORT_NUM
    AND YEAR(A1.ACC_DATE) = 2008
    GROUP BY P2.D_NAME, C1.MODEL
)

SELECT P.D_NAME FROM PERSON P, CAR C,OWNS O WHERE P.D_ID=O.D_ID AND C.REG_NO=O.REG_NO AND C.MODEL='A' GROUP BY P.D_NAME HAVING COUNT(*)>=1

SELECT P.D_NAME, COUNT(*) AS NUM_OF_CARS
FROM PERSON P, CAR C, OWNS O
WHERE P.D_ID = O.D_ID AND O.REG_NO = C.REG_NO AND C.MODEL = 'A'
GROUP BY P.D_NAME
HAVING COUNT(*) >= ALL
(
    SELECT COUNT(*) AS NUM_OF_CARS
    FROM PERSON P1, CAR C1, OWNS O1
    WHERE P1.D_ID = O1.D_ID AND O1.REG_NO = C1.REG_NO AND C1.MODEL = 'A'
    GROUP BY P1.D_NAME
);

SELECT P.D_NAME, SUM(P1.DAM_AMOUNT) AS TOTAL_DAMAGE_AMOUNT
FROM PERSON P, ACCIDENT A, PARTICIPATED P1
WHERE P.D_ID = P1.D_ID 
AND A.REPORT_NUM = P1.REPORT_NUM
AND YEAR(A.ACC_DATE) = 2008
GROUP BY P.D_NAME
HAVING SUM(P1.DAM_AMOUNT) <= ALL
(
    SELECT SUM(P4.DAM_AMOUNT) AS TOTAL_DAMAGE_AMOUNT
    FROM PERSON P2, ACCIDENT A1, PARTICIPATED P4
    WHERE P2.D_ID = P4.D_ID
    AND A1.REPORT_NUM = P4.REPORT_NUM
    AND YEAR(A1.ACC_DATE) = 2008
    GROUP BY P2.D_NAME
);


